<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>ArchistryJS Grid Test #1</title>
  <link type="text/css" href="../jqueryui/css/cupertino/jquery-ui-1.7.2.custom.css" rel="stylesheet" />
  <style type="text/css" media="screen">
/*
    .aui-grid 
    {
      font-family: sans-serif;
      border: 1px solid red;
      padding: 2px;
    }

    .aui-grid > table
    {
      border: 1px solid green;
      margin: 3px;
    }
*/
    .aui-grid td
    {
      vertical-align: top;
    }

    .aui-grid td input
    {
      border: 1px solid #e0aa0f;
      padding: 0;
      margin: 0;
    }

    .aui-grid > table th
    {
/*      color: white; */
      text-align: left;
/*      background: green; */
      border: 1px solid #aed0ea;
    }

    .aui-grid > table td, .aui-grid > table th
    {
      padding: 3px;
    }

/*    .aui-grid > table th.aui-grid-col-key
    {
      background: blue;
      color: white;
    }

    .aui-grid > table th.aui-grid-col-value
    {
      background: yellow;
    }
*/
    td.aui-grid-cell
    {
/*      border: 1px solid #002654; */
      border: 1px solid rgb(221,221,221);
    }

    .aui-grid tr.aui-grid-row-dirty
    {
      background: #f0e7f3;
      font-style: italic;
    }

    .aui-grid-cell-dirty
    {
      background: url(../images/changed-red.gif) top right no-repeat;
    }

    td.aui-grid-col-value
    {
/*      width: 250px; */
    }

    .aui-grid tr.aui-grid-header:hover
    {
      background: lightgreen;
    }

    tr.aui-grid-row-sentinal
    {
      background: #bec2c6;
      font-style: italic;
    }

    .aui-grid tr.aui-grid-row:hover
    {
/*      background: #f7eac3; */
        background: #e4f1fb;
        border: 1px solid #74b2e2;
    }

    .aui-grid tr.aui-grid-row:hover > td
    {
/*      border: 1px solid #e0aa0f; */
        border: 1px solid #74b2e2;
    }

    .aui-grid td.aui-grid-cell:hover
    {
/*      background: #f0d588; */
/*        background: #d7ebf9 url(../jqueryui/css/cupertino/images/ui-bg_glass_80_d7ebf9_1x400.png) 50% 50% repeat-x; */
        background: #d7ebf9;
        border: 1px solid #aed0ea;
        color: #2779aa
    }

    .aui-grid td.aui-grid-cell-dirty:hover
    {
/*      background: #f0d588 url(../images/changed-red.gif) top right no-repeat; */
      background: #d7ebf9 url(../images/changed-red.gif) top right no-repeat;
    }

    .aui-grid th.aui-grid-cell:hover
    {
/*      background: rgb(0,113,141); */
        background: #3baae3 url(../jqueryui/css/cupertino/images/ui-bg_glass_50_3baae3_1x400.png) 50% 50% repeat-x;
        border: 1px solid #294e80;
        color: #ffffff;
    }

    #changes
    {
      float: right;
    }
  </style>
  <script type="text/javascript" src="../js/ext/Math.uuid.js"></script>
  <script type="text/javascript" src="../js/ext/md5.js"></script>
  <script type="text/javascript" src="../js/core/core.js"></script>
  <script type="text/javascript" src="../js/core/observer.js"></script>
  <script type="text/javascript" src="../js/core/version.js"></script>
  <script type="text/javascript" src="../js/data/changeset.js"></script>
  <script type="text/javascript" src="../js/ui/console.js"></script>
  <script type="text/javascript" src="../js/ui/helpers.js"></script>
  <script type="text/javascript" src="../js/ui/property_editors.js"></script>
  <script type="text/javascript" src="../js/ui/grid.js"></script>
  <script type="text/javascript" src="../js/ext/jquery-1.3.2.js"></script>
</head>
 
<body>
  <h1>Test Grid</h1>
  <p>
  This example demonstrates two separate things:
  <ol>
  <li>Tracking object changes using the archistry.data.ChangeSet
  class, and</li>
  <li>Configuring a grid to observe and react to changes in the
  underlying data model</li>
  </ol>
  </p>
  <p>
  The first grid is the same as in the previous example, but the
  second one displays the contents of the ChangeSet that is modified
  by the first as it is edited.
  </p>

  <div id="changes"></div>
  <div id="testgrid"></div>

  <script type="text/javascript">
    $(function()
    {
      // configure the ChangeSet
      var ChangeSetRowModel = function(ch)
      {
        var _self = this;
        this.mixin(archistry.core.SignalSource);
        this.addValidSignals([
          "row-inserted",
          "row-deleted",
          "row-changed"
        ]);
        ch.signalConnect("object-inserted", function(sender, idx, data) {
          _self.signalEmit("row-inserted", _self, idx, data);
        });
        ch.signalConnect("object-deleted", function(sender, idx, data) {
          _self.signalEmit("row-deleted", _self, idx, data);
        });
        ch.signalConnect("object-changed", function(sender, idx, data) {
          _self.signalEmit("row-changed", _self, idx, data);
        });
        this.row = ch.get;
        this.ensureRange = function(startIdx, count)
        {
          return ((startIdx + count) < ch.length ? count : ch.length - startIdx);
        };

        this.dump = function() { return ""; /* no-op */ };
      };
      var changes = new archistry.data.ChangeSet();
      var chCols = new archistry.ui.ArrayColumnModel([
        { key: "object", label: "Object" },
        { key: "change", label: "Change Type" },
        { key: "key", label: "Property Key" },
        { key: "oldVal", label: "Previous Value" }
      ]);
      var chGrid = new archistry.ui.Grid("changes", chCols,
                    new ChangeSetRowModel(changes), { showHeader: true });

      var editor = new archistry.ui.editor.TextFieldEditor();
      
      var darray = [];
//      for(var i = 0; i < 20; ++i)
      for(var i = 0; i < 2; ++i)
      {
        darray.add({ key: "Key " + i, value: "<h3>Value " + i + "</h3>" });
//        darray.add({ key: "Key " + i, value: "Value " + i });
      }

      var cols = new archistry.ui.ArrayColumnModel([
        { key: "key", label: "Key", editor: editor },
        { key: "value", label: "Value", editor: editor }
      ]);
      var data = new archistry.ui.ArrayRowModel(darray, {
                    createRow: function()
                    {
                      var len = darray.length;
                      darray.add({ key: "Key " + len, value: null });
                      return darray[darray.length - 1];
                    }
      });
      var grid = new archistry.ui.Grid("testgrid", cols, data, {
                    changeSet: changes,
                    showHeader: true,
                    editable: true,
                    clicksToEdit: 2,
                    showSentinalRow: true
      });
    });
  </script>
</body>
</html>
